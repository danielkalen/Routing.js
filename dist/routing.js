(function(t){return function(){var l;l=function(e,g,h,n){n=function(f){return h[f]?g[f]:(h[f]=1,g[f]={},g[f]=e[f](g[f]))};e[2]=function(e){var d;e=d={};d.noop=function(){return Promise.resolve()};d.removeItem=function(c,a){var m;m=c.indexOf(a);-1!==m&&c.splice(m,1);return c};d.logError=function(c){c instanceof Error||(c=Error(c));null!=("undefined"!==typeof console&&null!==console?console.error:void 0)?console.error(c):null!=("undefined"!==typeof console&&null!==console?console.log:void 0)&&console.log(c)};
d.cleanPath=function(c){"#"===c[0]&&(c=c.slice(1));1<c.length&&("/"===c[0]&&(c=c.slice(1)),"/"===c[c.length-1]&&(c=c.slice(0,-1)));return c};d.parsePath=function(c){var a,m,b,k,e,p,d;k=!1;b="";d=[];d.dynamic={};p=c.length;e=-1;for(a=function(){d.push(b);k&&(d.dynamic[d.length-1]=b);k&&(d.hasDynamic=!0);b="";return k=!1};++e!==p;)switch(m=c[e]){case "/":a();break;case ":":k=!0;break;default:b+=m}a();return d};return e};return n};l=l({},{},{});return function(){var e,g,h;e=function(n){return function(f){var d,
c;d=function(a){a=d=function(a,b){this.path=a;this.segments=b;this.originalPath=this.path;this.A=this.eA=this.lA=c.noop;this.context={path:this.path,segments:this.segments,params:{}};this._d={};return this};d.prototype.entering=function(a){this.eA=a;return this};d.prototype.leaving=function(a){this.lA=a;return this};d.prototype.to=function(a){this.A=a;return this};d.prototype.filters=function(a){this._d=a;return this};d.prototype._R=
function(a,b,c){this._RP(a);return Promise.resolve(this.eA.call(this.context,c,b)).then(function(a){return function(){return a.A.call(a.context,c,b)}}(this))};d.prototype._L=function(a,b){return this.lA.call(this.context,b,a)};d.prototype._RP=function(a){var b,c,d;if(this.segments.hasDynamic)for(b in d=a.split("/"),c=this.segments.dynamic,c)a=c[b],this.context.params[a]=d[b]||""};return a}({});c=l(2);f=e=function(a){this.timeout=a;isNaN(this.timeout)&&
(this.timeout=2500);this.routes=[];this._s={};this._r={};this._c={};this._h=[];this._f=[];this._gB=this._gA=c.noop;this.current={route:null,path:null};this.prev={route:null,path:null};this._P=Promise.resolve();return this};e.prototype._M=function(a,d){var b,k,e,p,m,f,g,n,h,l,q,r;a=c.cleanPath(a);q=c.parsePath(a);r=q.join("/");f=this._r[r]||this._c[r];if(!f)for(n=this.routes,k=0,p=n.length;k<p;k++){h=n[k];g=!0;b=e=
0;for(m=q.length;e<m&&(l=q[b],l!==h.segments[b]&&(b=h.segments.dynamic[b],(g=null!=b)&&h._d[b]&&(g=h._d[b](l))),g);b=++e);if(g){f=h;break}}f?(this._c[r]=f,f.path=a):d&&this._s.rootPath&&(f=this._M(this._s.rootPath));return f||this._s.fallback};e.prototype._A=function(a){this.routes.push(a);this.routes.sort(function(a,c){var b;(b=c.segments.length-a.segments.length)||(b=c.segments.dynamic.length-a.segments.dynamic.length);
return b});return a};e.prototype.listen=function(){g._onChange(this._lC=function(a){return function(c){return a.go(window.location.hash,!1,c)}}(this));return this};e.prototype.refresh=function(){this.prev.path=this.current.path;this.prev.route=this.current.route;return this.go(this.current.path,!0)};e.prototype.go=function(a,d,b,e){var f;if("string"!==typeof a)return this._P;f=this._M(a,b);a=(null!=f?f.path:void 0)||a;if(f&&(a!==this.current.path||d))return function(b){return function(){d||
a===b.current.path||"*FALLBACK*"===a||(window.location.hash=a,b.current.path&&"back"!==e&&b._h.push(b.current.path),e||(b._f.length=0),b.prev.route=b.current.route,b.prev.path=b.current.path,b.current.route=f,b.current.path=a);b._P=b._P.then(function(){return new Promise(function(c,d){b._PP=a;setTimeout(function(){return d(Error("Timeout Error - "+a))},b.timeout);return Promise.resolve().then(b._gB).then(function(){var a;return null!=(a=b.prev.route)?
a._L(b.current.route,b.current.path):void 0}).then(function(){return f._R(a,b.prev.route,b.prev.path)}).then(b._gA).then(c)})});return b._P["catch"](function(a){c.logError(a);b._P=Promise.resolve();return b.go(b.prev.path)})}}(this)()};e.prototype.map=function(a){var e,b,f;a=c.cleanPath(a);b=c.parsePath(a);f=b.join("/");(e=this._r[f])||(e=this._r[f]=new d(a,b));return this._A(e)};e.prototype.beforeAll=function(a){this._gB=a;return this};
e.prototype.afterAll=function(a){this._gA=a;return this};e.prototype.root=function(a){this._s.rootPath=c.cleanPath(a);return this};e.prototype.fallback=function(a){this._s.fallback=new d("*FALLBACK*",[]);this._s.fallback.to(a);return this};e.prototype.back=function(){this.current.path&&this._f.unshift(this.current.path);return this.go(this._h.pop(),!1,!1,"back")};e.prototype.forward=function(){return this.go(this._f.shift(),!1,!1,"forward")};
e.prototype.kill=function(){this._r={};this._s={};this._c={};this.routes.length=this._h.length=this._f.length=0;this._gB=this._gA=c.noop;this.current.route=this.current.path=this.prev.route=this.prev.path=null};return f}}(this)({});h=l(2);g=new function(){var g,f,d,c;g=[];c=[];d=!1;f=function(a){var c,b,d;b=0;for(d=g.length;b<d;b++)c=g[b],c(!0===a)};this._onChange=function(a){g.push(a);if(d)return a(!0);d=!0;void 0!==window.onhashchange&&(!document.documentMode||
8<=document.documentMode)?window.addEventListener("hashchange",f):setInterval(f,100);return f(!0)};this.killAll=function(){var a,d,b,e;e=c.slice();a=0;for(d=e.length;a<d;a++)b=e[a],b.kill(),h.removeItem(c,b),h.removeItem(g,b._lC)};this.Router=function(a){c.push(a=new e(a));return a};this.version="1.0.1";return this};return null!=("undefined"!==typeof module&&null!==module?module.exports:void 0)?module.exports=g:"function"===typeof define&&define.amd?define(["routing.js"],function(){return g}):
this.Routing=g}()}})(this)();
