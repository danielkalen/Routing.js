!function(t){return function(){var t;return t=function(t,e,n,r){return r=function(r){return n[r]?e[r]:(n[r]=1,e[r]={},e[r]=t[r](e[r]))},t[2]=function(t){var e={exports:t},n;return e.exports=n={},n.noop=function(){return Promise.resolve()},n.removeItem=function(t,e){var n;return n=t.indexOf(e),-1!==n&&t.splice(n,1),t},n.logError=function(t){t instanceof Error||(t=new Error(t)),null!=("undefined"!=typeof console&&null!==console?console.error:void 0)?console.error(t):null!=("undefined"!=typeof console&&null!==console?console.log:void 0)&&console.log(t)},n.cleanPath=function(t){return"#"===t[0]&&(t=t.slice(1)),t.length>1&&("/"===t[0]&&(t=t.slice(1)),"/"===t[t.length-1]&&(t=t.slice(0,-1))),t},n.parsePath=function(t){var e,n,r,o,i,s,u;for(o=!1,r="",u=[],u.dynamic={},s=t.length,i=-1,e=function(){return u.push(r),o&&(u.dynamic[u.length-1]=r),o&&(u.hasDynamic=!0),r="",o=!1};++i!==s;)switch(n=t[i]){case"/":e();break;case":":o=!0;break;default:r+=n}return e(),u},e.exports},r},t=t({},{},{}),function(){var e,n,r;return e=function(r){return function(r){var o={exports:r},i,s,u;return s=function(t){var e={exports:t};return e.exports=s=function(t,e){return this.path=t,this.segments=e,this.originalPath=this.path,this.action=this.enterAction=this.leaveAction=u.noop,this.context={path:this.path,segments:this.segments,params:{}},this._dynamicFilters={},this},s.prototype.entering=function(t){return this.enterAction=t,this},s.prototype.leaving=function(t){return this.leaveAction=t,this},s.prototype.to=function(t){return this.action=t,this},s.prototype.filters=function(t){return this._dynamicFilters=t,this},s.prototype._run=function(t,e,n){return this._resolveParams(t),Promise.resolve(this.enterAction.call(this.context,n,e)).then(function(t){return function(){return t.action.call(t.context,n,e)}}(this))},s.prototype._leave=function(t,e){return this.leaveAction.call(this.context,e,t)},s.prototype._resolveParams=function(t){var e,n,r,o;if(this.segments.hasDynamic){o=t.split("/"),r=this.segments.dynamic;for(e in r)n=r[e],this.context.params[n]=o[e]||""}},e.exports}({}),u=t(2),i="*FALLBACK*",o.exports=e=function(t){return this.timeout=t,isNaN(this.timeout)&&(this.timeout=2500),this.routes=[],this._specialRoutes={},this._routesMap={},this._cache={},this._history=[],this._future=[],this._globalBefore=this._globalAfter=u.noop,this.current={route:null,path:null},this.prev={route:null,path:null},this._pendingRoute=Promise.resolve(),this},e.prototype._matchPath=function(t,e){var n,r,o,i,s,h,a,c,l,p,f,g,_;if(t=u.cleanPath(t),g=u.parsePath(t),_=g.join("/"),!(a=this._routesMap[_]||this._cache[_]))for(l=this.routes,o=0,s=l.length;o<s;o++){for(p=l[o],c=!0,r=i=0,h=g.length;i<h&&(f=g[r],f!==p.segments[r]&&(n=p.segments.dynamic[r],(c=null!=n)&&p._dynamicFilters[n]&&(c=p._dynamicFilters[n](f))),c);r=++i);if(c){a=p;break}}return a?(this._cache[_]=a,a.path=t):e&&this._specialRoutes.rootPath&&(a=this._matchPath(this._specialRoutes.rootPath)),a||this._specialRoutes.fallback},e.prototype._addRoute=function(t){return this.routes.push(t),this.routes.sort(function(t,e){var n;return n=e.segments.length-t.segments.length,n||(n=e.segments.dynamic.length-t.segments.dynamic.length),n}),t},e.prototype.listen=function(){return n._onChange(this._listenCallback=function(t){return function(e){return t.go(window.location.hash,!1,e)}}(this)),this},e.prototype.refresh=function(){return this.prev.path=this.current.path,this.prev.route=this.current.route,this.go(this.current.path,!0)},e.prototype.go=function(t,e,n,r){var o;return"string"!=typeof t?this._pendingRoute:(o=this._matchPath(t,n),t=(null!=o?o.path:void 0)||t,o&&(t!==this.current.path||e)?function(n){return function(){return e||t===n.current.path||t===i||(window.location.hash=t,n.current.path&&"back"!==r&&n._history.push(n.current.path),r||(n._future.length=0),n.prev.route=n.current.route,n.prev.path=n.current.path,n.current.route=o,n.current.path=t),n._pendingRoute=n._pendingRoute.then(function(){return new Promise(function(e,r){return n._pendingPath=t,setTimeout(function(){return r(new Error("Timeout Error - "+t))},n.timeout),Promise.resolve().then(n._globalBefore).then(function(){var t;return null!=(t=n.prev.route)?t._leave(n.current.route,n.current.path):void 0}).then(function(){return o._run(t,n.prev.route,n.prev.path)}).then(n._globalAfter).then(e)})}),n._pendingRoute.catch(function(t){return u.logError(t),n._pendingRoute=Promise.resolve(),n.go(n.prev.path)})}}(this)():void 0)},e.prototype.map=function(t){var e,n,r;return t=u.cleanPath(t),n=u.parsePath(t),r=n.join("/"),e=this._routesMap[r],e||(e=this._routesMap[r]=new s(t,n)),this._addRoute(e)},e.prototype.beforeAll=function(t){return this._globalBefore=t,this},e.prototype.afterAll=function(t){return this._globalAfter=t,this},e.prototype.root=function(t){return this._specialRoutes.rootPath=u.cleanPath(t),this},e.prototype.fallback=function(t){return this._specialRoutes.fallback=new s(i,[]),this._specialRoutes.fallback.to(t),this},e.prototype.back=function(){return this.current.path&&this._future.unshift(this.current.path),this.go(this._history.pop(),!1,!1,"back")},e.prototype.forward=function(){return this.go(this._future.shift(),!1,!1,"forward")},e.prototype.kill=function(){this._routesMap={},this._specialRoutes={},this._cache={},this.routes.length=this._history.length=this._future.length=0,this._globalBefore=this._globalAfter=u.noop,this.current.route=this.current.path=this.prev.route=this.prev.path=null},o.exports}}(this)({}),r=t(2),n=new function(){var t,n,o,i;return t=[],i=[],o=!1,n=function(e){var n,r,o;for(r=0,o=t.length;r<o;r++)(n=t[r])(!0===e)},this._onChange=function(e){return t.push(e),o?e(!0):(o=!0,void 0!==window.onhashchange&&(!document.documentMode||document.documentMode>=8)?window.addEventListener("hashchange",n):setInterval(n,100),n(!0))},this.killAll=function(){var e,n,o,s;for(s=i.slice(),e=0,n=s.length;e<n;e++)o=s[e],o.kill(),r.removeItem(i,o),r.removeItem(t,o._listenCallback)},this.Router=function(t){var n;return i.push(n=new e(t)),n},this.version="1.0.1",this},null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=n:"function"==typeof define&&define.amd?define(["routing.js"],function(){return n}):this.Routing=n}()}}(this)();