!function(t){return function(){var t;return t=function(t,e,n,r){return r=function(r){return n[r]?e[r]:(n[r]=1,e[r]={},e[r]=t[r](e[r]))},t[1]=function(t){var e={exports:t},n,o,i,s;return o=r(4),s=r(2),n="*FALLBACK*",e.exports=i=function(){function t(t,e){this.timeout=t,this.ID=e,isNaN(this.timeout)&&(this.timeout=2500),this.listening=!1,this.routes=[],this._specialRoutes={},this._routesMap={},this._cache={},this._history=[],this._future=[],this._globalBefore=this._globalAfter=s.noop,this.current={route:null,path:null},this.prev={route:null,path:null},this._pendingRoute=Promise.resolve()}return t.prototype._applyBase=function(t){return"/"===t[0]&&(t=t.slice(1)),this._specialRoutes.basePath&&0!==t.indexOf(this._specialRoutes.basePath)?this._specialRoutes.basePath+"/"+t:t},t.prototype._matchPath=function(t,e){var r,o,i,u,h,a,c,l,p,f,_,g,d;if(t===n)return this._specialRoutes.fallback;if(t=s.cleanPath(t),g=s.parsePath(t,this._specialRoutes.basePath),d=g.join("/"),c=this._routesMap[d]||this._cache[d],!this._specialRoutes.basePath||0===t.indexOf(this._specialRoutes.basePath)){if(!c)for(p=this.routes,i=0,h=p.length;i<h;i++){for(f=p[i],l=!0,o=u=0,a=g.length;u<a&&(_=g[o],_!==f.segments[o]&&(r=f.segments.dynamic[o],(l=null!=r)&&f._dynamicFilters[r]&&(l=f._dynamicFilters[r](_))),l);o=++u);if(l){c=f;break}}return c?(this._cache[d]=c,c.path=t):e&&this._specialRoutes.rootPath&&(c=this._matchPath(this._specialRoutes.rootPath)),c||this._specialRoutes.fallback}},t.prototype._addRoute=function(t){return this.routes.push(t),this.routes.sort(function(t,e){var n;return n=e.segments.length-t.segments.length,n||(n=e.segments.dynamic.length-t.segments.dynamic.length),n}),t},t.prototype.listen=function(){return this.listening=!0,Routing._onChange(this._listenCallback=function(t){return function(e){return t.go(window.location.hash,!1,e,null,!0)}}(this)),this},t.prototype.refresh=function(){return this.prev.path=this.current.path,this.prev.route=this.current.route,this.go(this.current.path,!0)},t.prototype.go=function(t,e,r,o,i){var u;return"string"!=typeof t?this._pendingRoute:(i||(t=this._applyBase(t)),u=this._matchPath(t,r),t=(null!=u?u.path:void 0)||t,u&&(t!==this.current.path||e)&&function(r){return function(){return e||t===r.current.path||t===n||(window.location.hash=t,r.current.path&&"back"!==o&&r._history.push(r.current.path),o||(r._future.length=0),r.prev.route=r.current.route,r.prev.path=r.current.path,r.current.route=u,r.current.path=t),r._pendingRoute=r._pendingRoute.then(function(){return new Promise(function(e,n){return r._pendingPath=t,setTimeout(function(){return n(new Error("TimeoutError: '"+t+"' failed to load within "+r.timeout+"ms (Router #"+r.ID+")"))},r.timeout),Promise.resolve().then(r._globalBefore).then(function(){var t;return null!=(t=r.prev.route)?t._leave(r.current.route,r.current.path):void 0}).then(function(){return u._run(t,r.prev.route,r.prev.path)}).then(r._globalAfter).then(e).catch(n)})}),r._pendingRoute.catch(function(t){return s.logError(t),r._pendingRoute=Promise.resolve(),r.go(r._specialRoutes.fallback?n:r.prev.path)})}}(this)(),this._pendingRoute)},t.prototype.map=function(t){var e,n,r;return t=s.cleanPath(t),n=s.parsePath(t),r=n.join("/"),e=this._routesMap[r],e||(e=this._routesMap[r]=new o(t,n)),this._addRoute(e)},t.prototype.beforeAll=function(t){return this._globalBefore=t,this},t.prototype.afterAll=function(t){return this._globalAfter=t,this},t.prototype.base=function(t){return this._specialRoutes.basePath=s.cleanPath(t),this},t.prototype.root=function(t){return this._specialRoutes.rootPath=s.cleanPath(t),this},t.prototype.fallback=function(t){return this._specialRoutes.fallback=new o(n,[]),this._specialRoutes.fallback.to(t),this},t.prototype.back=function(){return this.current.path&&this._future.unshift(this.current.path),this.go(this._history.pop(),!1,!1,"back")},t.prototype.forward=function(){return this.go(this._future.shift(),!1,!1,"forward")},t.prototype.kill=function(){this._routesMap={},this._specialRoutes={},this._cache={},this.routes.length=this._history.length=this._future.length=0,this._globalBefore=this._globalAfter=s.noop,this.current.route=this.current.path=this.prev.route=this.prev.path=null},t}(),e.exports},t[2]=function(t){var e={exports:t},n;return e.exports=n={},n.noop=function(){return Promise.resolve()},n.removeItem=function(t,e){var n;return n=t.indexOf(e),-1!==n&&t.splice(n,1),t},n.logError=function(t){t instanceof Error||(t=new Error(t)),null!=("undefined"!=typeof console&&null!==console?console.error:void 0)?console.error(t):null!=("undefined"!=typeof console&&null!==console?console.log:void 0)&&console.log(t)},n.cleanPath=function(t){return"#"===t[0]&&(t=t.slice(1)),t.length>1&&("/"===t[0]&&(t=t.slice(1)),"/"===t[t.length-1]&&(t=t.slice(0,-1))),t},n.parsePath=function(t,e){var n,r,o,i,s,u,h;for(i=!1,o="",h=[],h.dynamic={},e&&0===t.indexOf(e)&&(t=t.slice(e.length+1)),u=t.length,s=-1,n=function(){return h.push(o),i&&(h.dynamic[h.length-1]=o),i&&(h.hasDynamic=!0),o="",i=!1};++s!==u;)switch(r=t[s]){case"/":n();break;case":":i=!0;break;default:o+=r}return n(),h},e.exports},t[4]=function(t){var e={exports:t},n,o;return o=r(2),e.exports=n=function(){function t(t,e){this.path=t,this.segments=e,this.originalPath=this.path,this.action=this.enterAction=this.leaveAction=o.noop,this.context={path:this.path,segments:this.segments,params:{}},this._dynamicFilters={}}return t.prototype.entering=function(t){return this.enterAction=t,this},t.prototype.leaving=function(t){return this.leaveAction=t,this},t.prototype.to=function(t){return this.action=t,this},t.prototype.filters=function(t){return this._dynamicFilters=t,this},t.prototype._run=function(t,e,n){return this._resolveParams(t),Promise.resolve(this.enterAction.call(this.context,n,e)).then(function(t){return function(){return t.action.call(t.context,n,e)}}(this))},t.prototype._leave=function(t,e){return this.leaveAction.call(this.context,e,t)},t.prototype._resolveParams=function(t){var e,n,r,o;if(this.segments.hasDynamic){o=t.split("/"),r=this.segments.dynamic;for(e in r)n=r[e],this.context.params[n]=o[e]||""}},t}(),e.exports},r},t=t({},{},{}),function(){var e,n,r;return e=t(1),r=t(2),n=new function(){var t,n,o,i,s;return t=[],s=[],i=!1,n=0,o=function(e){var n,r,o;for(r=0,o=t.length;r<o;r++)(n=t[r])(!0===e)},this._onChange=function(e){return t.push(e),i?e(!0):(i=!0,void 0!==window.onhashchange&&(!document.documentMode||document.documentMode>=8)?window.addEventListener("hashchange",o):setInterval(o,100),o(!0))},this.killAll=function(){var e,n,o,i;for(i=s.slice(),e=0,n=i.length;e<n;e++)o=i[e],o.kill(),r.removeItem(s,o),r.removeItem(t,o._listenCallback)},this.Router=function(t){var r;return s.push(r=new e(t,++n)),r},this.version="1.0.4",this},null!=("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=n:"function"==typeof define&&define.amd?define(["routing.js"],function(){return n}):this.Routing=n}()}}(this)();