(function(t){return function(){var p;p=function(n,l,m,h){h=function(e){return m[e]?l[e]:(m[e]=1,l[e]={},l[e]=n[e](l[e]))};n[1]=function(e){var c,a,f;c=h(4);f=h(2);e=a=function(b){this.timeout=b;isNaN(this.timeout)&&(this.timeout=2500);this.listening=!1;this.routes=[];this._s={};this._r={};this._c={};this._h=[];this._f=[];this._gB=this._gA=f.noop;this.current={route:null,path:null};this.prev={route:null,path:null};this._P=Promise.resolve();
return this};a.prototype._M=function(b,a){var g,k,c,d,e,h,l,n,m,p,q,r;b=f.cleanPath(b);q=f.parsePath(b);r=q.join("/");h=this._r[r]||this._c[r];if(!h)for(n=this.routes,k=0,d=n.length;k<d;k++){m=n[k];l=!0;g=c=0;for(e=q.length;c<e&&(p=q[g],p!==m.segments[g]&&(g=m.segments.dynamic[g],(l=null!=g)&&m._d[g]&&(l=m._d[g](p))),l);g=++c);if(l){h=m;break}}h?(this._c[r]=h,h.path=b):a&&this._s.rootPath&&(h=this._M(this._s.rootPath));
return h||this._s.fallback};a.prototype._A=function(b){this.routes.push(b);this.routes.sort(function(b,a){var f;(f=a.segments.length-b.segments.length)||(f=a.segments.dynamic.length-b.segments.dynamic.length);return f});return b};a.prototype.listen=function(){this.listening=!0;Routing._onChange(this._lC=function(b){return function(a){return b.go(window.location.hash,!1,a)}}(this));return this};a.prototype.refresh=function(){this.prev.path=this.current.path;this.prev.route=
this.current.route;return this.go(this.current.path,!0)};a.prototype.go=function(b,a,g,c){var k;if("string"!==typeof b)return this._P;k=this._M(b,g);b=(null!=k?k.path:void 0)||b;if(k&&(b!==this.current.path||a))return function(d){return function(){a||b===d.current.path||"*FALLBACK*"===b||(window.location.hash=b,d.current.path&&"back"!==c&&d._h.push(d.current.path),c||(d._f.length=0),d.prev.route=d.current.route,d.prev.path=d.current.path,d.current.route=k,d.current.path=
b);d._P=d._P.then(function(){return new Promise(function(a,f){d._PP=b;setTimeout(function(){return f(Error("Timeout Error - "+b))},d.timeout);return Promise.resolve().then(d._gB).then(function(){var b;return null!=(b=d.prev.route)?b._L(d.current.route,d.current.path):void 0}).then(function(){return k._R(b,d.prev.route,d.prev.path)}).then(d._gA).then(a)})});return d._P["catch"](function(b){f.logError(b);d._P=Promise.resolve();
return d.go(d.prev.path)})}}(this)()};a.prototype.map=function(b){var a,g,e;b=f.cleanPath(b);g=f.parsePath(b);e=g.join("/");(a=this._r[e])||(a=this._r[e]=new c(b,g));return this._A(a)};a.prototype.beforeAll=function(b){this._gB=b;return this};a.prototype.afterAll=function(b){this._gA=b;return this};a.prototype.root=function(b){this._s.rootPath=f.cleanPath(b);return this};a.prototype.fallback=function(b){this._s.fallback=new c("*FALLBACK*",
[]);this._s.fallback.to(b);return this};a.prototype.back=function(){this.current.path&&this._f.unshift(this.current.path);return this.go(this._h.pop(),!1,!1,"back")};a.prototype.forward=function(){return this.go(this._f.shift(),!1,!1,"forward")};a.prototype.kill=function(){this._r={};this._s={};this._c={};this.routes.length=this._h.length=this._f.length=0;this._gB=this._gA=f.noop;this.current.route=this.current.path=
this.prev.route=this.prev.path=null};return e};n[2]=function(e){var c;e=c={};c.noop=function(){return Promise.resolve()};c.removeItem=function(a,f){var b;b=a.indexOf(f);-1!==b&&a.splice(b,1);return a};c.logError=function(a){a instanceof Error||(a=Error(a));null!=("undefined"!==typeof console&&null!==console?console.error:void 0)?console.error(a):null!=("undefined"!==typeof console&&null!==console?console.log:void 0)&&console.log(a)};c.cleanPath=function(a){"#"===a[0]&&(a=a.slice(1));1<a.length&&("/"===
a[0]&&(a=a.slice(1)),"/"===a[a.length-1]&&(a=a.slice(0,-1)));return a};c.parsePath=function(a){var f,b,k,g,c,e,d;g=!1;k="";d=[];d.dynamic={};e=a.length;c=-1;for(f=function(){d.push(k);g&&(d.dynamic[d.length-1]=k);g&&(d.hasDynamic=!0);k="";return g=!1};++c!==e;)switch(b=a[c]){case "/":f();break;case ":":g=!0;break;default:k+=b}f();return d};return e};n[4]=function(e){var c,a;a=h(2);e=c=function(f,b){this.path=f;this.segments=b;this.originalPath=this.path;this.A=this.eA=this.lA=
a.noop;this.context={path:this.path,segments:this.segments,params:{}};this._d={};return this};c.prototype.entering=function(a){this.eA=a;return this};c.prototype.leaving=function(a){this.lA=a;return this};c.prototype.to=function(a){this.A=a;return this};c.prototype.filters=function(a){this._d=a;return this};c.prototype._R=function(a,b,c){this._RP(a);return Promise.resolve(this.eA.call(this.context,c,b)).then(function(a){return function(){return a.A.call(a.context,
c,b)}}(this))};c.prototype._L=function(a,b){return this.lA.call(this.context,b,a)};c.prototype._RP=function(a){var b,c,f;if(this.segments.hasDynamic)for(b in f=a.split("/"),c=this.segments.dynamic,c)a=c[b],this.context.params[a]=f[b]||""};return e};return h};p=p({},{},{});return function(){var n,l,m;n=p(1);m=p(2);l=new function(){var h,e,c,a;h=[];a=[];c=!1;e=function(a){var b,c,f;c=0;for(f=h.length;c<f;c++)b=h[c],b(!0===a)};this._onChange=function(a){h.push(a);if(c)return a(!0);
c=!0;void 0!==window.onhashchange&&(!document.documentMode||8<=document.documentMode)?window.addEventListener("hashchange",e):setInterval(e,100);return e(!0)};this.killAll=function(){var c,b,e,g;g=a.slice();c=0;for(b=g.length;c<b;c++)e=g[c],e.kill(),m.removeItem(a,e),m.removeItem(h,e._lC)};this.Router=function(c){a.push(c=new n(c));return c};this.version="1.0.3";return this};return null!=("undefined"!==typeof module&&null!==module?module.exports:void 0)?module.exports=l:"function"===typeof define&&
define.amd?define(["routing.js"],function(){return l}):this.Routing=l}()}})(this)();
